# Qt桌面自动化工具

一个基于Qt C++开发的Windows桌面自动化工具，提供窗口管理、颜色拾取、鼠标点击模拟和键盘按键模拟功能。

## 项目架构

### 总体设计
本项目采用**类MVC架构模式**，将应用程序划分为三个逻辑层次：
- **View（视图层）**：MainWindow等UI类负责界面展示
- **Controller（控制层）**：MainWindow同时承担控制器角色，处理用户交互
- **Model（模型层）**：WindowManager、ColorPicker、ClickSimulator三个核心模块

### 目录结构
```
d:\ws\new\
├── include/                # 头文件目录
│   ├── core/              # 核心功能模块头文件
│   │   ├── WindowManager.h      # 窗口管理器
│   │   ├── ColorPicker.h        # 颜色拾取器
│   │   └── ClickSimulator.h     # 点击和键盘模拟器
│   ├── ui/                # 用户界面头文件
│   │   ├── MainWindow.h         # 主窗口
│   │   ├── LogWindow.h          # 日志窗口
│   │   └── WindowPreviewPage.h  # 窗口预览页面
│   └── utils/             # 工具类头文件
│       └── AsyncLogger.h        # 异步日志记录器
├── src/                   # 源文件目录
│   ├── core/              # 核心功能模块实现
│   ├── ui/                # 用户界面实现
│   ├── utils/             # 工具类实现
│   └── main.cpp           # 程序入口
├── CMakeLists.txt         # CMake构建配置
├── build-qt.bat           # Qt工具链构建脚本
└── README.md              # 项目说明文档
```

### 核心模块

#### 1. WindowManager - 窗口管理器
- **职责**：系统窗口的枚举和管理
- **功能**：
  - 枚举系统中所有可见窗口
  - 绑定目标窗口（通过HWND句柄）
  - 获取窗口信息（标题、位置、大小等）
  - 使用Windows API进行窗口操作

#### 2. ColorPicker - 颜色拾取器
- **职责**：实时屏幕颜色获取
- **功能**：
  - 通过QTimer定时器周期性捕获鼠标位置颜色
  - 检测颜色变化并发出信号通知
  - 提供开始/停止取色功能
  - 默认50ms更新间隔以平衡性能和实时性

#### 3. ClickSimulator - 点击和键盘模拟器
- **职责**：模拟鼠标点击和键盘按键操作
- **功能**：
  - **鼠标模拟**：
    - 支持多种坐标类型（屏幕坐标、窗口坐标、客户区坐标）
    - 使用SendMessage API实现后台点击
    - 支持左键、右键、中键点击
    - 支持单击和双击
  - **键盘模拟**：
    - 支持单个按键和组合键（Ctrl+, Alt+, Shift+）
    - 使用SendMessage API实现后台按键
    - 支持文本输入功能
    - 提供紧急释放所有按键功能
  - **坐标显示**：
    - 实时显示鼠标在目标窗口内的坐标
    - 支持快捷键（默认F9）捕获坐标到输入框
    - 同时显示屏幕坐标、窗口坐标、客户区坐标

#### 4. MainWindow - 主控制中心
- **职责**：作为应用程序的主窗口和控制中枢
- **功能**：
  - UI界面构建和布局管理
  - 用户交互事件处理
  - 协调各个核心模块的工作
  - 通过Qt信号槽机制与模型层通信

### 技术特点

#### 1. 模块化设计
- 各模块职责清晰，功能独立
- 模块间通过组合关系而非继承关系连接
- 便于维护和扩展

#### 2. 松耦合通信
- 使用Qt信号槽机制实现模块间通信
- 避免了直接的函数调用依赖
- 提高了代码的可维护性

#### 3. 后台操作
- 使用Windows SendMessage API而非PostMessage
- 支持窗口在后台或最小化状态下的操作
- 确保操作的可靠性和同步性

#### 4. 异步处理
- 包含AsyncLogger异步日志系统
- ColorPicker使用定时器进行异步颜色监测
- ClickSimulator支持坐标实时显示
- 提升了应用程序的响应性

## 构建与运行

### 环境要求
- Qt 6.9.2 (MinGW 64-bit)
- CMake 3.16+
- MinGW-w64 13.1.0

### 构建步骤
```bash
# 使用提供的Qt工具链构建脚本
.\build-qt.bat

# 或手动构建
mkdir cmake-build-debug
cd cmake-build-debug
cmake .. -G "MinGW Makefiles" -DCMAKE_BUILD_TYPE=Debug -DCMAKE_PREFIX_PATH="D:/Qt/6.9.2/mingw_64"
cmake --build . --config Debug
```

### 运行
构建成功后，可执行文件位于：`d:\ws\out\QtDemo.exe`

## 使用说明

1. **窗口绑定**：首先选择并绑定一个目标窗口
2. **颜色拾取**：点击"开始取色"按钮，移动鼠标获取颜色信息
3. **鼠标模拟**：输入坐标，选择按键类型和坐标类型，点击"执行点击"
4. **键盘模拟**：选择要发送的按键，可选择修饰键，点击"发送按键"或输入文本点击"发送文本"
5. **坐标显示**：开启坐标显示后，在目标窗口内移动鼠标可看到实时坐标，按F9键捕获当前坐标
6. **紧急功能**：如果键盘按键卡住，点击"紧急释放所有按键"按钮

## 项目特色

- ✅ **后台操作**：支持窗口在后台或最小化状态下的自动化操作
- ✅ **多坐标系统**：支持屏幕坐标、窗口坐标、客户区坐标的转换和使用
- ✅ **实时反馈**：提供详细的操作状态反馈和错误提示
- ✅ **安全机制**：提供紧急释放按键功能，防止按键卡住
- ✅ **模块化架构**：清晰的代码结构，易于理解和扩展
- ✅ **跨窗口操作**：可以对任意系统窗口进行自动化操作