<docs>
# 功能使用手册

<cite>
**本文档引用的文件**
- [MainWindow.cpp](file://src\ui\MainWindow.cpp) - *更新了窗口名称和UI布局*
- [MainWindow.h](file://include\ui\MainWindow.h) - *新增日志窗口集成*
- [LogWindow.cpp](file://src\ui\LogWindow.cpp) - *新增日志功能实现*
- [LogWindow.h](file://include\ui\LogWindow.h) - *新增日志窗口类定义*
- [InteractionFacade.cpp](file://src\core\InteractionFacade.cpp) - *核心交互门面模式实现*
- [InteractionFacade.h](file://include\core\InteractionFacade.h) - *统一接口定义*
- [ColorPicker.cpp](file://src\core\ColorPicker.cpp) - *颜色拾取器逻辑*
- [ClickSimulator.cpp](file://src\core\ClickSimulator.cpp) - *点击模拟器逻辑*
- [WindowManager.cpp](file://src\core\WindowManager.cpp) - *窗口管理器实现*
- [WindowManager.h](file://include\core\WindowManager.h) - *窗口信息结构体定义*
</cite>

## 目录
1. [原始按钮测试区域](#原始按钮测试区域)
2. [窗口绑定区域](#窗口绑定区域)
3. [颜色拾取区域](#颜色拾取区域)
4. [点击模拟区域](#点击模拟区域)
5. [日志显示区域](#日志显示区域)

## 原始按钮测试区域

主界面左上角的“点击我！”按钮是基础功能验证入口。当用户点击该按钮时，会触发 `onButtonClicked` 槽函数，弹出一个包含提示信息的消息框，用于确认UI交互正常。

**Section sources**
- [MainWindow.cpp](file://src\ui\MainWindow.cpp#L200-L205)

## 窗口绑定区域

此区域允许用户选择并绑定目标窗口，为后续操作提供作用对象。

### 刷新窗口列表
点击“刷新列表”按钮将调用 `onRefreshWindows` 槽函数。该函数通过 `interactionFacade->refreshWindowList()` 重新枚举系统中所有可见窗口，并将窗口标题和类名填充到 `windowComboBox` 下拉框中。

**Section sources**
- [MainWindow.cpp](file://src\ui\MainWindow.cpp#L207-L226)

### 选择窗口
在 `windowComboBox` 中选择不同项时，会触发 `onWindowSelectionChanged` 槽函数。该函数调用 `updateWindowInfo` 方法，实时更新下方 `windowInfoLabel` 显示所选窗口的详细信息，包括标题、类名、句柄及位置尺寸。

**Section sources**
- [MainWindow.cpp](file://src\ui\MainWindow.cpp#L248-L259)

### 绑定窗口
点击“绑定窗口”按钮执行 `onBindWindow` 槽函数。该函数首先检查是否已选择有效窗口，然后调用 `interactionFacade->bindWindow(index)` 将选中窗口的句柄绑定至 `InteractionFacade` 实例。成功后，相关信息会同步给 `MouseSimulator` 和 `KeyboardSimulator`，并在状态栏反馈结果。

```mermaid
sequenceDiagram
participant 用户
participant UI as MainWindow
participant IF as InteractionFacade
participant WM as WindowManager
用户->>UI : 点击"绑定窗口"
UI->>IF : bindWindow(index)
IF->>WM : 执行窗口绑定
WM-->>IF : 返回绑定结果
IF-->>UI : 通知绑定结果
alt 绑定成功
UI->>UI : 更新UI状态
UI->>UI : 同步目标窗口至Mouse/Keyboard模块
UI->>用户 : 显示成功消息框
else 绑定失败
UI->>用户 : 显示警告对话框
end
```

**Diagram sources**
- [MainWindow.cpp](file://src\ui\MainWindow.cpp#L228-L246)
- [InteractionFacade.cpp](file://src\core\InteractionFacade.cpp#L120-L135)
- [WindowManager.cpp](file://src\core\WindowManager.cpp#L85-L104)

## 颜色拾取区域

该功能支持实时获取屏幕任意位置的颜色值。

### 启动取色
点击“开始取色 (按ESC停止)”按钮触发 `onStartColorPicker` 槽函数。程序首先检查是否已绑定窗口，若未绑定则提示错误；否则启动 `ColorPicker` 的定时器，进入持续采样模式。

**Section sources**
- [MainWindow.cpp](file://src\ui\MainWindow.cpp#L251-L267)

### 颜色更新机制
`ColorPicker` 内部通过 `QTimer` 定时调用 `updateColor` 方法，获取当前光标位置的颜色。当颜色或位置发生变化时，发出 `colorChanged` 信号，由 `MainWindow` 的 `onColorChanged` 槽函数接收并更新 `colorDisplayLabel` 和 `colorInfoLabel` 的显示内容，包括RGB值和十六进制编码。

```mermaid
flowchart TD
A[启动取色] --> B{是否已绑定窗口?}
B --> |否| C[显示错误提示]
B --> |是| D[启动定时器]
D --> E[获取光标位置]
E --> F[读取像素颜色]
F --> G{颜色或位置变化?}
G --> |是| H[发射colorChanged信号]
H --> I[更新UI显示]
G --> |否| J[等待下次定时]
K[按下ESC或点击停止] --> L[停止定时器]
```

**Diagram sources**
- [ColorPicker.cpp](file://src\core\ColorPicker.cpp#L45-L85)
- [MainWindow.cpp](file://src\ui\MainWindow.cpp#L269-L280)

### 调节采样频率
用户可通过 `updateIntervalSpinBox` 控件调节 `ColorPicker` 的 `updateInterval` 属性，从而控制颜色采样的时间间隔（单位：毫秒），平衡精度与性能。

**Section sources**
- [MainWindow.cpp](file://src\ui\MainWindow.cpp#L185-L188)

## 点击模拟区域

此模块可模拟鼠标在指定坐标执行点击操作。

### 输入参数配置
用户需输入格式为 "x,y" 的坐标值，并从下拉框中选择坐标类型（屏幕/窗口/客户区）、鼠标按键（左/右/中键），以及是否双击和延迟时间等参数。

### 执行点击
点击“执行点击”按钮调用 `onSimulateClick` 槽函数。该函数首先验证目标窗口是否存在及坐标格式是否正确，随后解析参数并调用 `interactionFacade->mouseClick()` 方法执行模拟点击。过程中会根据设置插入相应延迟。

```mermaid
sequenceDiagram
participant 用户
participant UI as MainWindow
participant IF as InteractionFacade
participant MS as MouseSimulator
用户->>UI : 输入参数并点击"执行点击"
UI->>UI : 验证目标窗口和坐标格式
alt 验证失败
UI->>用户 : 显示错误状态
else 验证成功
UI->>IF : mouseClick(x, y, coordType, button, clickType)
IF->>MS : 执行鼠标点击
MS->>MS : 转换坐标系
MS->>MS : 发送鼠标消息
alt 成功
MS-->>IF : 发射mouseClickExecuted信号
IF-->>UI : 转发clickExecuted信号
UI->>UI : 更新状态栏为成功
else 失败
MS-->>IF : 发射mouseClickFailed信号
IF-->>UI : 转发clickFailed信号
UI->>UI : 更新状态栏为失败
end
end
```

**Diagram sources**
- [MainWindow.cpp](file://src\ui\MainWindow.cpp#L282-L346)
- [InteractionFacade.cpp](file://src\core\InteractionFacade.cpp#L160-L185)
- [MouseSimulator.cpp](file://src\core\MouseSimulator.cpp#L35-L110)

### 结果反馈
点击执行结果通过信号槽机制反馈：成功时 `onClickExecuted` 槽函数更新状态栏显示成功信息；失败时 `onClickFailed` 槽函数显示具体错误原因。

**Section sources**
- [MainWindow.cpp](file://src\ui\MainWindow.cpp#L348-L389)

## 日志显示区域

新增的日志功能提供了完整的运行时活动记录，帮助用户追踪操作历史和诊断问题。

### 日志功能概述
系统集成了 `LogWindow` 类作为独立标签页，实现了日志的实时显示、过滤、保存和清除功能。所有用户操作和系统事件都会被记录到异步日志系统中，并在日志窗口中展示。

### 主要特性
- **自动滚动**: 默认开启，新日志条目会自动滚动到底部
- **级别过滤**: 支持按调试、信息、警告、错误、操作等级别过滤
- **清空日志**: 可一键清除当前显示的所有日志
- **保存日志**: 可将日志导出为文本文件，便于分享和分析
- **动态计数**: 实时显示可见日志条目数量

### 使用流程
1. 在主窗口底部的标签页中选择"日志记录"标签
2. 查看实时更新的操作日志和系统消息
3. 使用顶部控件进行过滤、保存或清除操作
4. 通过级别下拉框选择需要查看的日志类型

### 技术架构
日志系统采用单例模式的 `AsyncLogger` 进行日志收集，`LogWindow` 通过信号槽机制接收日志条目。这种设计确保了日志记录不会阻塞主线程，保证了UI的响应性。

```mermaid
classDiagram
class AsyncLogger {
+static instance()
+logEntryAdded(LogEntry)
+addLog(LogLevel, category, message, details)
}
class LogWindow {
+onLogEntryAdded(LogEntry)
+clearLogs()
+saveLogsToFile()
-setupUI()
-connectSignals()
}
class MainWindow {
+setupLogPage()
+connectSignals()
}
AsyncLogger --> LogWindow : 信号连接
MainWindow --> LogWindow : 添加为标签页
LogWindow ..> AsyncLogger : 订阅日志事件
```

**Diagram sources**
- [LogWindow.h](file://include\ui\LogWindow.h)
- [LogWindow.cpp](file://src\ui\LogWindow.cpp)
- [MainWindow.cpp](file://src\ui\MainWindow.cpp#L100-L110)
- [AsyncLogger.h](file://include\utils\AsyncLogger.h)

### 日志级别说明
- **DEBUG**: 调试信息，用于开发阶段的问题排查
- **INFO**: 一般信息，记录系统状态和常规操作
- **WARN**: 警告信息，可能存在潜在问题但不影响运行
- **ERROR**: 错误信息，操作失败或异常情况
- **ACTION**: 用户关键操作记录，如按钮点击、窗口绑定等

**Section sources**
- [LogWindow.cpp](file://src\ui\LogWindow.cpp#L200-L300)
- [MainWindow.cpp](file://